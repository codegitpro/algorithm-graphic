First the function tries to make initial groups just by one theme for example 'title'. 
And then it rearrange the groups by moving members between groups if it thinks that new groups are better than previous groups.
There is a function to calculate of the harmony score of the group using several themes defined.